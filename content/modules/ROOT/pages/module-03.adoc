= Lab Guide: Creating a Rulebook Activation
:doctype: book
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_A guide to creating and understanding Rulebook Activations in Event-Driven Ansible._

---

== Introduction

Up to this point, you've inspected a rulebook but haven't seen how to start it. **Rulebook Activations** are the "always listening" part of Event-Driven Ansible. They combine a Project (containing rulebooks) with a Decision Environment to create a listener that is always running, waiting for new events to handle.

Event-Driven Ansible manages the restart of a Rulebook Activation if it stops due to a failure, and the **Rule Audit** screen shows a record every time an event is received that matches a condition in the rulebook.

[IMPORTANT]
====
.Environment Credentials
====
.Ansible Automation Platform (AAP)
* **Username:** `admin`
* **Password:** `ansible123!`

.Gitea
* **Username:** `student`
* **Password:** `learn_ansible`
====

---

== Task: Create a Rulebook Activation

In this task, you will create and enable a Rulebook Activation.

.   **Navigate to the Rulebook Activations page.**
+
    In the `AAP` tab, go to the left navigation menu and select **Automation Decisions** → **Rulebook Activations**.

.   **Create a new Rulebook Activation.**
+
    **Click** the blue **Create rulebook activation** button.

.   **Enter the activation details.**
+
    **Fill** out the form with the following values:
+
[cols="1,2,2a"]
|===
| Key | Value | Notes

| *Name*
| `Alertmanager events`
|

| *Description*
| `Catch alerts coming from alertmanager`
|

| *Organization*
| `Default`
|

| *Project*
| `My EDA project`
|

| *Rulebook*
| `alertmanager.yml`
|

| *Credential*
| `AAP`
| This credential is used to execute job templates in the automation controller.

| *Decision environment*
| `Default Decision Environment`
|

| *Restart policy*
| `On failure`
|

| *Log level*
| `Debug`
|

| *Rulebook activation enabled?*
| ☑
| Ensure this is enabled.
|===
+
NOTE: For product documentation, see link:https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html/using_automation_decisions/eda-rulebook-activations[Using automation decisions: Chapter 8. Rulebook activations].

.   **Save the activation.**
+
    **Click** the **Create rulebook activation** button at the bottom of the form.
+
image::../assets/Nov-12-2024_at_13.56.18-image.png[Completed Rulebook Activation form, opts="border"]

.   **Review the activation status.**
+
    You will be taken to a details page for the new Rulebook Activation. The *Activation status* may show as "Pending" or "Starting" but should transition to **Running** momentarily.

.   **Check the activation history.**
+
    **Select** the **History** tab at the top. Each time this Rulebook Activation starts or restarts, it gets a new ID and a new entry on this page. This is because each activation is a new `ansible-rulebook` process running inside a container.
+
image:../assets/Oct-17-2024_at_13.46.34-image.png[Running rulebook activation History tab, opts="border"]

.   **View the debug output.**
+
    You can **click** the link for the running activation (e.g., "1 - Alertmanager events") to see the live debug output of the running rulebook.

At this point, you have a rulebook that is actively listening for events from Alertmanager.

---

== Next Steps

Now that your listener is active, it's time to generate an event. Proceed to the next challenge to continue.

== Troubleshooting

If you have encountered an issue with this lab, please link:https://github.com/ansible/instruqt/issues/new?labels=eda-up-and-running-25&title=New+EDA+issue:+create-rulebook-activation+(Sandbox+id:+[[ Instruqt-Var key="SANDBOX" hostname="aap" ]])&assignees=cloin[open an issue on GitHub].
